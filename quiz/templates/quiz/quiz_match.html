{% load static %}
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'quiz/css/match.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <title>Quiz回答</title>
  </head>
  <body>
    <nav class="navbar bg-body-tertiary">
      <div class="container-fluid">
        <h1 class="me-auto">
          対戦部屋 : <span id="quiz-category">{{ category }}</span>
        </h1>
        <button class="btn home_button" style="background-color: #2de6eb">
          <a href="{% url 'home' %}" style="text-decoration: none; color: white"
            >ホームへ戻る</a
          >
        </button>
      </div>
    </nav>
    <div class="quiz_container hidden">
      <div class="quiz_info container-fluid row d-flex justify-content-around">
        <div class="quiz_header">
          <h1 id="quiz-title"></h1>
          <!-- クイズのタイトル -->
          <p id="quiz-description"></p>
          <!-- クイズの説明 -->
        </div>
        <div class="profile card">
          <div class="card-body row">
            <div class="my_info col-4">
              <span class="myName"></span>
              <p>自分の判定: <span id="my_judge"></span></p>
              <p>自分のスコア: <span id="my_score">0</span></p>
            </div>
            <div class="vs col-4">
              <h3>vs</h3>
            </div>
            <div class="opp_info col-4">
              <span class="oppName"></span>
              <p>相手の判定: <span id="opp_judge"></span></p>
              <p>相手のスコア: <span id="opp_score">0</span></p>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <p id="answer_count_p">
              回答終了まであと<span
                id="answer_count"
                style="font-weight: bold"
              ></span
              >秒
            </p>
            <p id="next_count_p">
              次の問題まであと<span
                id="next_count"
                style="font-weight: bold"
              ></span
              >秒
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="match_back p-3">
      <div class="container">
        <div id="wait_container">
          <div class="card" style="height: 100%">
            <div class="card-body">
              <h2>対戦相手を待っています...</h2>
            </div>
          </div>
        </div>
        <div id="pre_container" class="hidden">
          <div class="card" style="height: 100%">
            <div class="card-body">
              <h2>対戦相手が見つかりました！</h2>
              <h2>あと<span id="start_count"></span>秒で開始します...</h2>
              <div class="profile card">
                <h3 class="card-body">
                  <span class="myName"></span> vs
                  <span class="oppName"></span>
                </h3>
              </div>
            </div>
          </div>
        </div>

        <div class="quiz_container hidden">
          <div class="card">
            <div class="card-body">
              <h2>問題</h2>
              <h4 id="quiz-content"></h4>
            </div>
          </div>
          <div class="row">
            <div class="s_head col-6 p-3">
              <button class="selection btn" id="correct_answer"></button>
            </div>
            <div class="s_head col-6 p-3">
              <button class="selection btn" id="incorrect1"></button>
            </div>
            <div class="s_head col-6 p-3">
              <button class="selection btn" id="incorrect2"></button>
            </div>
            <div class="s_head col-6 p-3">
              <button class="selection btn" id="incorrect3"></button>
            </div>
          </div>

          <div>
            <div id="now_result">
              <h2>回答</h2>
              <p>自分の回答: <span id="my_answer"></span></p>
              <p>相手の回答: <span id="opp_answer"></span></p>
            </div>
          </div>

          <div class="hidden" id="explanation">
            <div class="card">
              <div class="card-body">
                <div>正解：<span id="quiz-correct"></span></div>
                <p>解説</p>
                <p id="quiz-explanation"></p>
              </div>
            </div>
          </div>
        </div>

        <div id="result_container" class="hidden">
          <h1>対戦結果</h1>
          <table class="table col-12">
            <tr>
              <th>問題</th>
              <th><span class="myName"></span></th>
              <th><span class="oppName"></span></th>
            </tr>
            <tbody id="quiz_result"></tbody>
          </table>
          <h1 id="winner" class="col-12"></h1>
        </div>
      </div>
    </div>

    <script>
      const category = "{{ category|escapejs }}"; // テンプレートから受け取ったカテゴリをエスケープして安全にJavaScript変数へ
      const DATA_URL = `/quiz/get_data/${category}/`; // URLを構築
      console.log("Category:", category); // 確認用
      console.log("DATA_URL:", DATA_URL); // 確認用
    </script>

    <script
      type="text/javascript"
      src="{% static 'quiz/js/match_ws.js' %}"
    ></script>
  </body>
</html>
